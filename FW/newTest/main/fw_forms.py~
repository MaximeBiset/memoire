from django import forms
from django.utils.translation import ugettext as _
from django.utils.translation import ugettext_lazy as __
from django.utils import timezone
from main.models import User, VerifiedInformation, EmergencyContact, JobType, MemberType, GIVINGTO
from branch.models import Job, Branch, JobCategory, TIME_CHOICES
from multiselectfield import MultiSelectField
from bootstrap3_datetime.widgets import DateTimePicker
from ajax_select.fields import AutoCompleteWidget
from django.forms.extras import SelectDateWidget
import datetime
from django.template.defaultfilters import filesizeformat

class GiftForm(forms.Form):
    """
    check = forms.ChoiceField(label = __("Donner à:"),widget=forms.RadioSelect, choices=GIVINGTO, initial=1)
    user = forms.CharField(required=False, label = __("Username"), widget=AutoCompleteWidget('user'))
    amount = forms.IntegerField(label = __("Montant du temps (plus que 1)"), min_value=1, initial=60)
    message = forms.CharField(required=False, widget=forms.Textarea, label = __("Message"))

    def __init__(self, *args, **kwargs):
        self.ruser = kwargs.pop('ruser')
        super(GiftForm, self).__init__(*args, **kwargs)

    def clean_user(self):
        print(self.cleaned_data)
        cleaned_data = super(GiftForm, self).clean()
        if self.cleaned_data['check']=='1':
            if self.cleaned_data['user']=="":
                raise forms.ValidationError(_("Indiquez un utilisateur."))     
        
            try:
                a = User.objects.get(username=self.cleaned_data['user'])
            except Exception:
                raise forms.ValidationError(_("Indiquez un utilisateur existant."))
        
            if a.id == self.ruser.id:
                raise forms.ValidationError(_("Vous ne pouvez pas donner à vous même."))
        return cleaned_data['user']

    def clean_amount(self):
        cleaned_data = super(GiftForm, self).clean()
        if self.cleaned_data['amount'] > self.ruser.credit:
            raise forms.ValidationError(_("Vous ne pouvez pas donner plus d'heure que ce que vous avez."))
        return cleaned_data['amount']
    """
